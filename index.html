ent co-tr"></div>
                    <div class="corner-ornament co-br"></div>
                    
                    <div class="cover-content">
                        <div class="divider divider-top"></div>
                        <h1>Mana i entulë<br>nómë?</h1>
                        <div class="divider divider-bottom"></div>
                    </div>
                </div>
            </div>

            <div class="turning-page p1" onclick="closeBook()"></div>
            <div class="turning-page p2" onclick="closeBook()"></div>
            <div class="turning-page p3" onclick="closeBook()"></div>
            <div class="turning-page p4" onclick="closeBook()"></div>
            <div class="turning-page p5" onclick="closeBook()"></div>
            <div class="turning-page p6" onclick="closeBook()"></div>

            <div class="right-stack">
                <div id="obra-titulo"></div>
                <div id="obra-sinopse"></div>
                <a id="obra-link" target="_blank">Ler Obra →</a>
            </div>

            <div class="ribbon-container">
                <div class="ribbon" id="ribbon"></div>
            </div>
        </div>
    </div>
</div>

<script>
    const obras = [
        { titulo: "Dom Casmurro", sinopse: "Maomao é uma garota que trabalha na corte da China Imperial. A história começa quando ela, que antes vivia como apotecária no bairro das cortesãs, acaba ouvindo um barco de que todos os filhos do imperador têm vidas muito curtas. Movida por sua curiosidade e desejo por conhecimento, Maomao começa a investigar a causa por puro interesse. Que destino será aguardado…?!", link: "https://panini.com.br/kusuriya-no-hitorigoto-diarios-de-uma-apotecaria-01?srsltid=AfmBOopJBx_xLPE_CVfeoEyd2W_qoy_CBzGoTYQ6oepvDsRBbGeVtHw8" },
        { titulo: "O Alienista", sinopse: "Maomao é uma garota que trabalha na corte da China Imperial. A história começa quando ela, que antes vivia como apotecária no bairro das cortesãs, acaba ouvindo um barco de que todos os filhos do imperador têm vidas muito curtas. Movida por sua curiosidade e desejo por conhecimento, Maomao começa a investigar a causa por puro interesse. Que destino será aguardado…?!", link: "https://codepen.io/pen/?editors=1000" },
        { titulo: "Diarios de uma apotecaria", sinopse:"Maomao é uma garota que trabalha na corte da China Imperial. A história começa quando ela, que antes vivia como apotecária no bairro das cortesãs, acaba ouvindo um barco de que todos os filhos do imperador têm vidas muito curtas. Movida por sua curiosidade e desejo por conhecimento, Maomao começa a investigar a causa por puro interesse. Que destino será aguardado…?!", link: "https://github.com/rayarchive/Sorteio-Livro/tree/main" },
        { titulo: "Iracema", sinopse: "Maomao é uma garota que trabalha na corte da China Imperial. A história começa quando ela, que antes vivia como apotecária no bairro das cortesãs, acaba ouvindo um barco de que todos os filhos do imperador têm vidas muito curtas. Movida por sua curiosidade e desejo por conhecimento, Maomao começa a investigar a causa por puro interesse. Que destino será aguardado…?!", link: "https://www.notion.so/Widgets-2e4d0c17411c802c9c58fab52e5bcbd7" }
    ];

    let aberto = false;
    let sorteando = false;
    let currentScale = 1;
    const book = document.getElementById('book');
    const ribbon = document.getElementById('ribbon');
    const wrapper = document.getElementById('scaleWrapper');

    function resizeBook() {
        const winW = window.innerWidth;
        const winH = window.innerHeight;
        
        // No mobile, usamos uma base menor (320) para o livro expandir mais.
        // No PC, usamos 500 para manter o respiro lateral.
        const refWidth = (winW < 500) ? 320 : 500;
        const refHeight = 500;
        
        currentScale = Math.min(winW / refWidth, winH / refHeight);
        
        // Trava para não ficar absurdamente grande em telas ultra-wide
        if (currentScale > 1.3) currentScale = 1.3;
        
        wrapper.style.transform = `scale(${currentScale})`;
    }

    window.addEventListener('resize', resizeBook);
    window.addEventListener('load', resizeBook);

    function carregarObraAleatoria() {
        const random = obras[Math.floor(Math.random() * obras.length)];
        document.getElementById('obra-titulo').innerText = random.titulo;
        document.getElementById('obra-sinopse').innerText = random.sinopse;
        document.getElementById('obra-link').href = random.link;
    }
    carregarObraAleatoria();

    function toggleBook() {
        if (!aberto) {
            aberto = true;
            book.classList.add('open');
        } else {
            closeBook();
        }
    }

    function closeBook() {
        aberto = false;
        book.classList.remove('open');
    }

    // Lógica da Fita
    let startY = 0;
    let isPulling = false;
    const baseRibbonHeight = 380;

    const startPull = (e) => {
        if (!aberto || sorteando) return;
        isPulling = true;
        startY = (e.touches ? e.touches[0].clientY : e.clientY);
        ribbon.classList.add('pulling');
    };

    const pull = (e) => {
        if (!isPulling) return;
        let currentY = (e.touches ? e.touches[0].clientY : e.clientY);
        let deltaY = (currentY - startY) / currentScale; 

        if (deltaY > 0) {
            let move = Math.min(deltaY, 100);
            ribbon.style.height = `${baseRibbonHeight + move}px`;
            if (deltaY > 70) {
                isPulling = false;
                sortear();
            }
        }
    };

    const endPull = () => {
        if (isPulling) {
            isPulling = false;
            ribbon.classList.remove('pulling');
            ribbon.style.height = `${baseRibbonHeight}px`;
        }
    };

    ribbon.addEventListener('mousedown', startPull);
    document.addEventListener('mousemove', pull);
    document.addEventListener('mouseup', endPull);
    ribbon.addEventListener('touchstart', startPull, {passive: false});
    document.addEventListener('touchmove', pull, {passive: false});
    document.addEventListener('touchend', endPull);

    function sortear() {
        sorteando = true;
        ribbon.style.height = `${baseRibbonHeight + 40}px`;
        const t = document.getElementById('obra-titulo');
        const s = document.getElementById('obra-sinopse');
        let i = 0;
        const interval = setInterval(() => {
            let random = obras[Math.floor(Math.random() * obras.length)];
            t.innerText = random.titulo;
            s.innerText = "...";
            i++;
            if (i > 8) {
                clearInterval(interval);
                carregarObraAleatoria();
                sorteando = false;
                ribbon.style.height = `${baseRibbonHeight}px`;
            }
        }, 100);
    }
</script>
</body>
</html>
